---
layout: post
title: 帮你彻底搞懂JS中的prototype、__proto__与constructor（图解）
categories: 前端技术
description: some word here
tags: prototype __proto__ constructor
---
* content
{:toc}
<div class="postImg" style="background-image:url(https://likonion-1254082995.cos.ap-chengdu.myqcloud.com/media/2017-10-22_133351.jpg)"></div>
作为一名前端工程师，必须搞懂JS中的 `prototype` 、`__proto__`与`constructor`属性，相信很多初学者对这些属性存在许多困惑，容易把它们混淆，本文旨在帮助大家理清它们之间的关系并彻底搞懂它们。这里说明一点，`__proto__`属性的两边是各由两个下划线构成。




### 前言

现在正式开始！ 让我们从如下一个简单的例子展开讨论，并配以相关的图帮助理解：
```js
function Foo() {...};
let f1 = new Foo();
```
以上代码表示创建一个构造函数 `Foo()` ，并用 `new` 关键字实例化该构造函数得到一个实例化对象 `f1` 。虽然是简简单单的两行代码，然而它们背后的关系却是错综复杂的，如下图所示：
![](https://likonion-1254082995.cos.ap-chengdu.myqcloud.com/media/20180726092835731.png)

看到这图别怕，让我们一步步剖析，彻底搞懂它们。（图的说明：右下角为图例，红色箭头表示 `__proto__` 属性指向、绿色箭头表示 `prototype` 属性的指向、棕色箭头表示 `constructor` 属性的指向；蓝色方块表示对象，浅绿色方块表示函数（这里为了更好看清，`Foo()` 仅代表是函数，并不是指执行函数 `Foo` 后得到的结果，图中的其他函数同理）。图的中间部分即为它们之间的联系，图的最左边即为例子代码）


首先，我们需要牢记两点：
1. `__proto__` 和 `constructor` 属性是 **对象** 所独有的；
2. `prototype` 属性是 **函数** 所独有的。但是由于JS中函数也是一种对象，所以函数也拥有 `__proto__` 和 `constructor` 属性，这点是致使我们产生困惑的很大原因之一。

### __proto__ 属性

上图有点复杂，我们把它按照属性分别拆开，然后进行分析：
![](https://likonion-1254082995.cos.ap-chengdu.myqcloud.com/media/20180725213654251.png)

> 这里我们仅留下 `__proto__` 属性，它是 **对象所独有的**，可以看到 `__proto__` 属性都是由 **一个对象指向一个对象**，即指向它们的原型对象（也可以理解为父对象），那么这个属性的作用是什么呢？它的作用就是当访问一个对象的属性时，如果该对象内部不存在这个属性，那么就会去它的 `__proto__` 属性所指向的那个对象（可以理解为父对象）里找，如果父对象也不存在这个属性，则继续往父对象的 `__proto__` 属性所指向的那个对象（可以理解为爷爷对象）里找，如果还没找到，则继续往上找…直到原型链顶端 `null` （可以理解为原始人。。。），此时若还没找到，则返回 `undefined` （可以理解为，再往上就已经不是“人”的范畴了，找不到了，到此为止），由以上这种通过 `__proto__` 属性来连接对象直到null的一条链即为我们所谓的 **原型链**。

### prototype 属性

![](https://likonion-1254082995.cos.ap-chengdu.myqcloud.com/media/20180725215624971.png)

> `prototype` 属性，别忘了一点，就是我们前面提到要牢记的两点中的第二点，它是 **函数所独有的**，它是从 **一个函数指向一个对象**。它的含义是 **函数的原型对象**，也就是这个函数（其实所有函数都可以作为构造函数）所创建的实例的原型对象，由此可知：`f1.__proto__ === Foo.prototype` ，它们两个完全一样。那 `prototype` 属性的作用又是什么呢？它的作用就是包含可以由特定类型的所有实例共享的属性和方法，也就是让该函数所实例化的对象们都可以找到公用的属性和方法。

### constructor 属性

![](https://likonion-1254082995.cos.ap-chengdu.myqcloud.com/media/20180726092751467.png)

> `constructor` 属性也是 **对象才拥有的**，它是从 **一个对象指向一个函数**，含义就是 **指向该对象的构造函数**，每个对象都有构造函数，从图中可以看出Function这个对象比较特殊，它的构造函数就是它自己（因为 `Function` 可以看成是一个函数，也可以是一个对象），所有函数最终都是由 `Function()` 构造函数得来，所以 `constructor` 属性的终点就是 **`Function()`**。

### 总结

1. 我们需要牢记两点：
    1. `__proto__`和`constructor`属性是对象所独有的；
    2. `prototype`属性是函数所独有的，因为函数也是一种对象，所以函数也拥有`__proto__`和`constructor`属性。
2. `__proto__`属性的作用就是当访问一个对象的属性时，如果该对象内部不存在这个属性，那么就会去它的`__proto__`属性所指向的那个对象（父对象）里找，一直找，直到3. `__proto__`属性的终点`null`，然后返回`undefined`，通过`__proto__`属性将对象连接起来的这条链路即我们所谓的原型链。
3. `prototype`属性的作用就是让该函数所实例化的对象们都可以找到公用的属性和方法，即`f1.__proto__ === Foo.prototype`。
4. `constructor`属性的含义就是指向该对象的构造函数，所有函数（此时看成对象了）最终的构造函数都指向`Function()`。

